# DLPDF - ウェブサイトをPDFに変換するツール

`download_and_pdf.sh`は、指定されたウェブサイトのページをサイトマップから効率的に収集し、それらをPDFファイルに変換するためのシェルスクリプトです。ウェブコンテンツを簡単にオフライン閲覧可能なPDF形式で保存します。

## 機能

- サイトマップ（sitemap.xml）からURLを自動収集
- ドメインルート検索による代替サイトマップの検出
- Google Chromeのヘッドレスモードを使用したPDF変換
- 複数のURLの一括処理
- 単一ページのみをPDF化する機能
- タイムアウト処理によるPDF変換の安定性確保
- 対話的な出力先選択と処理確認オプション
- 進捗表示と処理結果のレポート

## 必要条件

- bash シェル
- curl, grep, sed, awk
- Google Chrome（PDF変換に使用）

## インストール方法

1. このリポジトリをクローンまたはダウンロードします
2. スクリプトの実行権限を付与します：

```bash
chmod +x download_and_pdf.sh
```

## 使用方法

```bash
./download_and_pdf.sh [オプション] <base_url>
```

### オプション

| オプション | 説明 |
|------------|------|
| `-h, --help` | ヘルプメッセージを表示 |
| `-o, --output DIR` | PDFの出力先ディレクトリを指定（デフォルト: $HOME/Downloads/<ドメイン名>） |
| `-d, --debug` | デバッグモード（一時ファイルを保持） |
| `-s, --single` | 単一ページモード（指定されたURLのみをPDFに変換） |
| `-w, --wait NUM` | ページ間の待機時間（秒）、デフォルト: 0.1秒 |

### 使用例

基本的な使用方法:
```bash
./download_and_pdf.sh https://nextjs.org/docs/app
```

単一ページのみをPDF化:
```bash
./download_and_pdf.sh --single https://nextjs.org/docs/app/start
```

出力先を指定:
```bash
./download_and_pdf.sh --output ./docs_pdf https://nextjs.org/docs/app
```

待機時間を2秒に設定（サーバー負荷軽減）:
```bash
./download_and_pdf.sh --wait 2 https://example.com
```

## 動作の仕組み

1. スクリプトは指定されたベースURLからスタート
2. 単一ページモードが指定された場合は、そのURLのみをPDFに変換して終了
3. 通常モードの場合：
   - ベースURLのサブディレクトリでサイトマップ（sitemap.xml）を検索
   - サブディレクトリでサイトマップが見つからない場合、ドメインルートで検索
   - サイトマップから指定されたベースURLに関連するURLを抽出
4. 収集したURLを処理し、Google Chromeのヘッドレスモードを使用してPDFに変換
5. 処理結果（成功/失敗数、所要時間）を表示

## 制限事項

- 通常モードではサイトマップが必須（サイトマップが見つからない場合は処理を終了）
- JavaScriptによる動的コンテンツは完全にレンダリングされない場合があります
- ログインが必要なページには対応していません
- 大量のURLを処理する場合は、サーバーに過度な負荷をかけないよう--waitオプションで待機時間を調整してください

## トラブルシューティング

### サイトマップが見つからない場合
- ベースURLが正しいか確認してください
- ウェブサイトが実際にサイトマップを提供しているか確認してください
- 直接サイトマップファイルを指定することも検討してください
- または、`--single`オプションを使用して単一ページのみを変換することもできます

### PDF変換に失敗する場合
- Google Chromeが正しくインストールされているか確認してください
- --debug オプションを使用してデバッグ情報を確認してください
- --wait オプションで待機時間を増やし、ページの完全な読み込みを待つようにしてください
- 特に大きなページや複雑なページでは、より長いタイムアウト時間が必要な場合があります

### その他の問題
- システム要件（curl, grep, sedなど）が満たされているか確認してください
- ネットワーク接続に問題がないか確認してください
- 出力先に書き込み権限があるか確認してください
